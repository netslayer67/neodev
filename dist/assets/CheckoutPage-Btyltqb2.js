import{o as U,u as X,g as Y,h as Z,a as O,r as s,t as ee,v as I,w as T,j as e,m as ae,I as w,B as M}from"./index-prnh0kJO.js";import{H as se}from"./Helmet-SIPCh4To.js";import{L as te}from"./label-BLVgaqYa.js";import{u as re,s as m,S as ne,m as L,H as ie}from"./ShippingCalculator-JxImhXVE.js";import{C as V}from"./credit-card-Bul8xivK.js";import{T as E}from"./truck-DyDmy6Es.js";import{C as le}from"./check-circle-BuVzsy5i.js";import{L as R}from"./lock-DmiWr7Xs.js";import"./index-BBHzotsr.js";import"./alert-circle-pXYVWN08.js";const de=U("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),oe={hidden:{opacity:0,y:20},show:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},C=s.memo(({id:n,label:d,tooltip:o,children:i,...g})=>e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsxs(te,{htmlFor:n,className:"text-sm font-medium text-foreground/80 flex items-center gap-1",children:[d,o&&e.jsx(ie,{size:14,className:"text-muted-foreground group-hover:text-foreground transition duration-300",title:o})]}),i||e.jsx(w,{id:n,...g,className:`bg-card/60 border border-border focus:border-accent focus:ring-2 focus:ring-accent/40 \r
                     text-foreground transition duration-300 rounded-xl py-3 w-full`})]})),ce=s.memo(({item:n})=>{const[d,o]=s.useState(!1);return e.jsxs("div",{className:"flex items-start justify-between gap-4 p-3 rounded-lg bg-card/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-lg overflow-hidden bg-muted",children:e.jsx("img",{src:n.images?.[0]?.url||"/placeholder.svg",alt:n.name,className:`w-full h-full object-cover transition-opacity duration-300 ${d?"opacity-100":"opacity-0"}`,onLoad:()=>o(!0),loading:"lazy"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:n.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Size ",n.size," • Qty ",n.quantity]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",m.formatPrice(n.price)]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-mono font-semibold text-sm",children:m.formatPrice(n.price*n.quantity)})})]})}),S=s.memo(({label:n,value:d,className:o="",highlight:i=!1})=>e.jsxs("div",{className:`flex justify-between items-center ${o} ${i?"text-lg font-bold":"text-sm"}`,children:[e.jsx("span",{className:i?"text-foreground":"text-muted-foreground",children:n}),e.jsx("span",{className:`font-mono ${i?"text-accent font-bold":"text-foreground"}`,children:d})]})),Ne=()=>{const{isLoaded:n}=re(),d=X(),o=Y(),{toast:i}=Z(),g=O(s.useCallback(a=>a.auth.user,[])),h=O(s.useCallback(a=>a.cart.cartItems,[])),z=O(s.useCallback(a=>a.orders.status,[])),[u,$]=s.useState("shipping"),[x,F]=s.useState("va"),[c,B]=s.useState(0),[P,q]=s.useState("REG"),[t,D]=s.useState({street:"",city:"",province:"",postalCode:"",country:"Indonesia",phone:""}),[f,G]=s.useState({isValid:!1,errors:[]}),b=s.useRef(!1),H=s.useMemo(()=>h.reduce((a,l)=>{const r=l.weight||300;return a+r*l.quantity},0),[h]),p=s.useMemo(()=>{const a=h.reduce((k,N)=>k+N.price*N.quantity,0),l=x==="cod"?2500:0,r=x==="va"?3e3:0,v=a+c+l-r;return{subtotal:a,shippingFee:c,adminFee:l,discount:r,total:v,savings:c===0?15e3:0}},[h,x,c]),K=s.useMemo(()=>[{id:"va",name:"Pembayaran Online",desc:"Virtual Account, E-Wallet, Credit Card",icon:V,recommended:!0},{id:"cod",name:`Cash On Delivery (+${m.formatPrice(p.adminFee)})`,desc:"Bayar saat barang diterima",icon:de,fee:p.adminFee}],[p.adminFee]),j=s.useCallback(()=>{const a=[];return(!t.street||t.street.trim().length<10)&&a.push("Alamat lengkap minimal 10 karakter"),(!t.city||t.city.trim().length<3)&&a.push("Nama kota/kabupaten harus diisi"),(!t.postalCode||!m.isValidPostalCode(t.postalCode))&&a.push("Kode pos harus 5 digit angka"),(!t.phone||!m.isValidPhoneNumber(t.phone))&&a.push("Nomor telepon tidak valid"),G({isValid:a.length===0,errors:a}),a.length===0},[t]),A=s.useCallback((a,l)=>{D(r=>({...r,[a]:l}))},[]),W=s.useCallback((a,l)=>{B(a),q(l)},[]),J=s.useCallback(()=>{if(!j()){i({variant:"destructive",title:"Alamat tidak lengkap",description:"Mohon lengkapi dan periksa kembali alamat pengiriman Anda"});return}if(c===0&&!m.isLikelyJabodetabek(t.city)){i({variant:"destructive",title:"Ongkir belum dihitung",description:"Silakan tunggu perhitungan ongkir selesai"});return}$("payment")},[t,c,j,i]),_=s.useCallback(()=>{$("shipping")},[]),Q=s.useCallback(async a=>{if(a.preventDefault(),!j()){i({variant:"destructive",title:"Alamat tidak valid",description:"Mohon periksa kembali alamat pengiriman Anda"});return}const l={items:h.map(r=>({product:r._id,quantity:r.quantity,size:r.size})),shippingAddress:{...t,fullName:g.name},paymentMethod:x,shippingCost:c,selectedShippingService:P,notes:""};b.current=!0;try{const r=await d(ee(l)).unwrap(),v=r.data||r;if(!v||!v.order||!v.order.orderId)throw console.error("Invalid order response:",r),new Error("Order creation failed - missing order data");const k=v.order.orderId;if(x==="va"){const N=r.data?.midtransSnapToken||r.midtransSnapToken;console.log("Initiating VA payment:",{isLoaded:n,hasSnap:!!window.snap,hasToken:!!N,result:r}),n&&window.snap&&N?window.snap.pay(N,{onSuccess:y=>{console.log("Midtrans onSuccess triggered:",y),i({title:"Pembayaran Berhasil! 🎉",description:`Order #${k} telah dibayar`}),d(I()),d(T()),o("/profile",{state:{activeView:"orders"}}),b.current=!1},onPending:y=>{console.log("Midtrans onPending triggered:",y),i({title:"Pembayaran Pending ⏳",description:`Order #${k} menunggu pembayaran`}),o("/profile",{state:{activeView:"orders"}}),b.current=!1},onError:y=>{console.error("Midtrans onError triggered:",y),i({variant:"destructive",title:"Pembayaran Gagal",description:y.message||"Terjadi kesalahan dalam pembayaran"}),b.current=!1},onClose:()=>{console.log("Midtrans onClose triggered - payment cancelled by user"),i({title:"Pembayaran Dibatalkan",description:"Anda menutup halaman pembayaran."})}}):(console.error("Payment system not ready:",{isLoaded:n,hasSnap:!!window.snap,hasToken:!!r.midtransSnapToken}),i({variant:"destructive",title:"Error",description:"Sistem pembayaran belum siap. Silakan coba lagi."}))}else console.log("COD payment, navigating to profile"),i({title:"Order Berhasil Dibuat! 🎉",description:`Order #${k} akan segera diproses`}),d(I()),d(T()),o("/profile",{state:{activeView:"orders"}}),b.current=!1}catch(r){console.error("Order creation failed:",r),i({variant:"destructive",title:"Gagal membuat pesanan",description:r.message||"Terjadi kesalahan saat membuat pesanan. Silakan coba lagi."}),b.current=!1}},[h,t,g.name,x,c,P,n,d,i,o,j]);return s.useEffect(()=>{h.length===0&&!b.current&&o("/cart")},[]),s.useEffect(()=>{u==="shipping"&&j()},[t,u,j]),e.jsxs("div",{className:"relative min-h-screen px-4 pt-24 pb-20 sm:px-6 lg:px-10 font-sans text-foreground",children:[e.jsxs(se,{children:[e.jsx("title",{children:"Checkout - Radiant Rage"}),e.jsx("meta",{name:"description",content:"Selesaikan pembelian Anda dengan aman dan mudah"})]}),e.jsx("div",{className:"absolute -top-24 -left-20 w-72 h-72 bg-accent/25 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-28 -right-20 w-96 h-96 bg-secondary/30 rounded-full blur-3xl"}),e.jsxs(ae.div,{variants:oe,initial:"hidden",animate:"show",className:"relative z-10 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-heading font-bold bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text",children:"Checkout"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Selesaikan pembelian Anda dengan aman"}),e.jsxs("div",{className:"flex items-center justify-center mt-6 space-x-4",children:[e.jsxs("div",{className:`flex items-center space-x-2 ${u==="shipping"?"text-accent":"text-muted-foreground"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border-2 ${u==="shipping"?"border-accent bg-accent text-white":"border-muted-foreground"}`,children:"1"}),e.jsx("span",{className:"text-sm font-medium",children:"Alamat"})]}),e.jsx("div",{className:"w-8 h-0.5 bg-border"}),e.jsxs("div",{className:`flex items-center space-x-2 ${u==="payment"?"text-accent":"text-muted-foreground"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border-2 ${u==="payment"?"border-accent bg-accent text-white":"border-muted-foreground"}`,children:"2"}),e.jsx("span",{className:"text-sm font-medium",children:"Pembayaran"})]})]})]}),e.jsxs("form",{onSubmit:Q,className:"flex flex-col lg:grid lg:grid-cols-5 gap-8",children:[e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(E,{size:20,className:"text-accent"}),"Alamat Pengiriman"]}),u!=="shipping"&&e.jsx("button",{type:"button",onClick:_,className:"text-sm text-accent hover:text-accent/80 transition duration-300 font-medium",children:"Edit"})]}),u==="shipping"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsx(C,{id:"fullName",label:"Nama Lengkap",children:e.jsx(w,{id:"fullName",defaultValue:g?.name,readOnly:!0,className:"bg-muted/50"})}),e.jsx(C,{id:"email",label:"Email",children:e.jsx(w,{id:"email",defaultValue:g?.email,readOnly:!0,className:"bg-muted/50"})})]}),e.jsx(C,{id:"phone",label:"No. Telepon",tooltip:"Format: 08xxxxxxxxxx atau +62xxxxxxxxxx",children:e.jsx(w,{id:"phone",value:t.phone,onChange:a=>A("phone",a.target.value),placeholder:"08xxxxxxxxxx",required:!0,className:f.errors.some(a=>a.includes("telepon"))?"border-red-500":""})}),e.jsx(C,{id:"street",label:"Alamat Lengkap",children:e.jsx("textarea",{id:"street",value:t.street,onChange:a=>A("street",a.target.value),placeholder:"Jalan, No. Rumah, RT/RW, Kelurahan, Kecamatan",className:`w-full p-3 border rounded-xl bg-card/60 min-h-[80px] resize-none transition duration-300 focus:border-accent focus:ring-2 focus:ring-accent/40 ${f.errors.some(a=>a.includes("Alamat"))?"border-red-500":"border-border"}`,required:!0})}),e.jsx("div",{className:"grid sm:grid-cols-2 gap-4",children:e.jsx(C,{id:"postalCode",label:"Kode Pos",tooltip:"5 digit kode pos Indonesia",children:e.jsx(w,{id:"postalCode",value:t.postalCode,onChange:a=>A("postalCode",a.target.value),placeholder:"12345",maxLength:5,required:!0,className:f.errors.some(a=>a.includes("Kode pos"))?"border-red-500":""})})}),e.jsx(ne,{shippingAddress:t,onShippingCostChange:W,cartWeight:H,onAddressChange:A}),f.errors.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-2",children:"Perhatian:"}),e.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:f.errors.map((a,l)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-1 bg-red-600 rounded-full"}),a]},l))})]}),e.jsx("div",{className:"mt-6",children:e.jsx(M,{type:"button",onClick:J,disabled:!f.isValid,className:"w-full rounded-full font-bold btn-primary py-3 disabled:opacity-50",children:"Lanjut ke Pembayaran"})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-start gap-3 p-4 bg-muted/30 rounded-lg",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:g?.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:g?.email}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.phone})]})}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsx("p",{className:"text-sm",children:t.street}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.city,", ",t.postalCode]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-accent/10 rounded-lg",children:[e.jsx(E,{size:16,className:"text-accent"}),e.jsxs("span",{className:"text-sm font-medium text-accent",children:[P," - ",m.formatPrice(c)]}),c===0&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full",children:"GRATIS"})]})]})]}),e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center gap-2",children:[e.jsx(V,{size:20,className:"text-accent"}),"Metode Pembayaran"]}),u==="payment"&&e.jsx(L,{value:x,onChange:F,className:"space-y-3",children:K.map(a=>e.jsx(L.Option,{value:a.id,children:({checked:l})=>e.jsxs("div",{className:`rounded-xl border px-6 py-4 transition duration-300 cursor-pointer relative ${l?"border-accent ring-2 ring-accent/50 bg-accent/5":"border-border hover:border-accent/40 hover:bg-accent/5"}`,children:[a.recommended&&e.jsx("span",{className:"absolute -top-2 left-4 px-2 py-1 text-xs font-medium bg-accent text-white rounded-full",children:"Direkomendasikan"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a.icon,{size:20,className:"text-foreground/70"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.desc})]})]}),l&&e.jsx(le,{className:"text-accent",size:20})]})]})},a.id))})]})]}),e.jsx("div",{className:"lg:col-span-2 lg:sticky lg:top-24 self-start",children:e.jsxs("div",{className:"glass-card p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6",children:"Ringkasan Pesanan"}),e.jsx("div",{className:"space-y-3 mb-6",children:h.map(a=>e.jsx(ce,{item:a},`${a._id}-${a.size}`))}),e.jsx("div",{className:"border-t border-border my-6"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(S,{label:"Subtotal",value:m.formatPrice(p.subtotal)}),e.jsx(S,{label:`Ongkir (${P})`,value:c===0?"GRATIS":m.formatPrice(p.shippingFee),className:c===0?"text-green-600":""}),p.savings>0&&e.jsx(S,{label:"Hemat ongkir",value:`-${m.formatPrice(p.savings)}`,className:"text-green-600"}),x==="cod"&&p.adminFee>0&&e.jsx(S,{label:"Biaya Admin COD",value:m.formatPrice(p.adminFee)})]}),e.jsx("div",{className:"border-t border-border my-6"}),e.jsx(S,{label:"Total",value:m.formatPrice(p.total),highlight:!0}),e.jsxs(M,{type:"submit",size:"lg",disabled:u!=="payment"||z==="loading"||!f.isValid,className:"w-full mt-6 rounded-full font-bold btn-primary py-4 disabled:opacity-50 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-accent/20 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"}),e.jsx(R,{size:18,className:"mr-2"}),z==="loading"?"Memproses...":x==="cod"?"Buat Pesanan":"Bayar Sekarang"]}),x==="va"&&e.jsx("p",{className:"text-xs text-muted-foreground text-center mt-3",children:"Anda akan diarahkan ke halaman pembayaran yang aman"}),e.jsxs("div",{className:"flex items-center justify-center space-x-4 mt-4 pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground",children:[e.jsx(R,{size:12}),e.jsx("span",{children:"SSL Secure"})]}),e.jsx("div",{className:"w-1 h-1 bg-muted-foreground rounded-full"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Pembayaran Aman"})]})]})})]})]})]})};export{Ne as default};
