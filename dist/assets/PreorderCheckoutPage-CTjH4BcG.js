import{u as U,g as X,h as Y,a as A,r,M as Z,v as ee,w as se,j as e,m as re,I as w,B as R}from"./index-prnh0kJO.js";import{H as ae}from"./Helmet-SIPCh4To.js";import{L as te}from"./label-BLVgaqYa.js";import{u as ne,s as x,S as ie,m as T,H as de}from"./ShippingCalculator-JxImhXVE.js";import{C as z}from"./credit-card-Bul8xivK.js";import{T as E}from"./truck-DyDmy6Es.js";import{A as L}from"./award-CCoPQd6g.js";import{C as oe}from"./check-circle-BuVzsy5i.js";import{C as $}from"./clock-B6wggCtW.js";import{L as M}from"./lock-DmiWr7Xs.js";import"./index-BBHzotsr.js";import"./alert-circle-pXYVWN08.js";const le={hidden:{opacity:0,y:20},show:{opacity:1,y:0,transition:{duration:.4,ease:"easeOut"}}},y=r.memo(({id:n,label:c,tooltip:o,children:i,...u})=>e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsxs(te,{htmlFor:n,className:"text-sm font-medium text-foreground/80 flex items-center gap-1",children:[c,o&&e.jsx(de,{size:14,className:"text-muted-foreground group-hover:text-foreground transition duration-300",title:o})]}),i||e.jsx(w,{id:n,...u,className:`bg-card/60 border border-border focus:border-accent focus:ring-2 focus:ring-accent/40\r
                     text-foreground transition duration-300 rounded-xl py-3 w-full`})]})),ce=r.memo(({item:n})=>{const[c,o]=r.useState(!1);return e.jsxs("div",{className:"flex items-start justify-between gap-4 p-3 rounded-lg bg-card/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 rounded-lg overflow-hidden bg-muted",children:e.jsx("img",{src:n.images?.[0]?.url||"/placeholder.svg",alt:n.name,className:`w-full h-full object-cover transition-opacity duration-300 ${c?"opacity-100":"opacity-0"}`,onLoad:()=>o(!0),loading:"lazy"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:n.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Size ",n.size," â€¢ Qty ",n.quantity]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["@",x.formatPrice(n.price)]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(L,{className:"w-3 h-3 text-warning"}),e.jsx("span",{className:"text-xs text-warning font-medium",children:"PREORDER"})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-mono font-semibold text-sm",children:x.formatPrice(n.price*n.quantity)})})]})}),C=r.memo(({label:n,value:c,className:o="",highlight:i=!1})=>e.jsxs("div",{className:`flex justify-between items-center ${o} ${i?"text-lg font-bold":"text-sm"}`,children:[e.jsx("span",{className:i?"text-foreground":"text-muted-foreground",children:n}),e.jsx("span",{className:`font-mono ${i?"text-accent font-bold":"text-foreground"}`,children:c})]})),we=()=>{const{isLoaded:n}=ne(),c=U(),o=X(),{toast:i}=Y(),u=A(r.useCallback(s=>s.auth.user,[])),p=A(r.useCallback(s=>s.cart.cartItems,[])),V=A(r.useCallback(s=>s.orders.status,[])),[m,I]=r.useState("shipping"),[O,q]=r.useState("va"),[l,B]=r.useState(0),[k,F]=r.useState("REG"),[a,D]=r.useState({street:"",city:"",province:"",postalCode:"",country:"Indonesia",phone:""}),[g,G]=r.useState({isValid:!1,errors:[]}),h=r.useRef(!1),K=r.useMemo(()=>p.reduce((s,d)=>{const t=d.weight||300;return s+t*d.quantity},0),[p]),v=r.useMemo(()=>{const s=p.reduce((S,j)=>S+j.price*j.quantity,0),d=0,t=0,b=s+l+d-t;return{subtotal:s,shippingFee:l,adminFee:d,discount:t,total:b,preorderSavings:s*.2}},[p,l]),H=r.useMemo(()=>[{id:"va",name:"Virtual Account (VA) - Required for Preorder",desc:"BCA VA, BNI VA, BRI VA, Permata VA, Other VA",icon:z,recommended:!0,required:!0}],[]),f=r.useCallback(()=>{const s=[];return(!a.street||a.street.trim().length<10)&&s.push("Alamat lengkap minimal 10 karakter"),(!a.city||a.city.trim().length<3)&&s.push("Nama kota/kabupaten harus diisi"),(!a.postalCode||!x.isValidPostalCode(a.postalCode))&&s.push("Kode pos harus 5 digit angka"),(!a.phone||!x.isValidPhoneNumber(a.phone))&&s.push("Nomor telepon tidak valid"),G({isValid:s.length===0,errors:s}),s.length===0},[a]),P=r.useCallback((s,d)=>{D(t=>({...t,[s]:d}))},[]),W=r.useCallback((s,d)=>{B(s),F(d)},[]),J=r.useCallback(()=>{if(!f()){i({variant:"destructive",title:"Alamat tidak lengkap",description:"Mohon lengkapi dan periksa kembali alamat pengiriman"});return}if(l===0&&!x.isLikelyJabodetabek(a.city)){i({variant:"destructive",title:"Ongkir belum dihitung",description:"Silakan tunggu perhitungan ongkir selesai"});return}I("payment")},[a,l,f,i]),_=r.useCallback(()=>{I("shipping")},[]),Q=r.useCallback(async s=>{if(s.preventDefault(),!f()){i({variant:"destructive",title:"Alamat tidak valid",description:"Mohon periksa kembali alamat pengiriman Anda"});return}const d={items:p.map(t=>({product:t._id,quantity:t.quantity,size:t.size})),shippingAddress:{...a,fullName:u.name},paymentMethod:"va",shippingCost:l,selectedShippingService:k,notes:"Preorder Order"};h.current=!0;try{const t=await c(Z(d)).unwrap(),b=t.data||t;if(!b||!b.order||!b.order.orderId)throw console.error("Invalid order response:",t),new Error("Order creation failed - missing order data");const S=b.order.orderId,j=t.data?.midtransSnapToken||t.midtransSnapToken;console.log("Initiating preorder VA payment:",{isLoaded:n,hasSnap:!!window.snap,hasToken:!!j,result:t}),n&&window.snap&&j?window.snap.pay(j,{onSuccess:N=>{console.log("Preorder Midtrans onSuccess triggered:",N),i({title:"Preorder Berhasil! ðŸŽ‰",description:`Preorder #${S} telah dibayar. Produksi akan segera dimulai!`}),c(ee()),c(se()),o("/profile",{state:{activeView:"orders"}}),h.current=!1},onPending:N=>{console.log("Preorder Midtrans onPending triggered:",N),i({title:"Preorder Pending â³",description:`Preorder #${S} menunggu pembayaran`}),o("/profile",{state:{activeView:"orders"}}),h.current=!1},onError:N=>{console.error("Preorder Midtrans onError triggered:",N),i({variant:"destructive",title:"Pembayaran Preorder Gagal",description:N.message||"Terjadi kesalahan dalam pembayaran preorder"}),h.current=!1},onClose:()=>{console.log("Preorder Midtrans onClose triggered - payment cancelled by user"),i({title:"Preorder Dibatalkan",description:"Anda menutup halaman pembayaran preorder."})}}):(console.error("Preorder payment system not ready:",{isLoaded:n,hasSnap:!!window.snap,hasToken:!!t.midtransSnapToken}),i({variant:"destructive",title:"Error",description:"Sistem pembayaran preorder belum siap. Silakan coba lagi."}))}catch(t){console.error("Preorder creation failed:",t),i({variant:"destructive",title:"Gagal membuat preorder",description:t.message||"Terjadi kesalahan saat membuat preorder. Silakan coba lagi."}),h.current=!1}},[p,a,u.name,l,k,n,c,i,o,f]);return r.useEffect(()=>{p.length===0&&!h.current&&o("/preorder")},[]),r.useEffect(()=>{m==="shipping"&&f()},[a,m,f]),e.jsxs("div",{className:"relative min-h-screen px-4 pt-24 pb-20 sm:px-6 lg:px-10 font-sans text-foreground",children:[e.jsxs(ae,{children:[e.jsx("title",{children:"Preorder Checkout - Radiant Rage"}),e.jsx("meta",{name:"description",content:"Selesaikan preorder Anda dengan aman dan mudah"})]}),e.jsx("div",{className:"absolute -top-24 -left-20 w-72 h-72 bg-warning/25 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-28 -right-20 w-96 h-96 bg-accent/30 rounded-full blur-3xl"}),e.jsxs(re.div,{variants:le,initial:"hidden",animate:"show",className:"relative z-10 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-heading font-bold bg-gradient-to-r from-warning to-accent bg-clip-text text-transparent",children:"Preorder Checkout"}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:"Secure your exclusive items with VA payment"}),e.jsxs("div",{className:"flex items-center justify-center mt-6 space-x-4",children:[e.jsxs("div",{className:`flex items-center space-x-2 ${m==="shipping"?"text-warning":"text-muted-foreground"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border-2 ${m==="shipping"?"border-warning bg-warning text-white":"border-muted-foreground"}`,children:"1"}),e.jsx("span",{className:"text-sm font-medium",children:"Alamat"})]}),e.jsx("div",{className:"w-8 h-0.5 bg-border"}),e.jsxs("div",{className:`flex items-center space-x-2 ${m==="payment"?"text-warning":"text-muted-foreground"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border-2 ${m==="payment"?"border-warning bg-warning text-white":"border-muted-foreground"}`,children:"2"}),e.jsx("span",{className:"text-sm font-medium",children:"Pembayaran"})]})]})]}),e.jsxs("form",{onSubmit:Q,className:"flex flex-col lg:grid lg:grid-cols-5 gap-8",children:[e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(E,{size:20,className:"text-accent"}),"Alamat Pengiriman Preorder"]}),m!=="shipping"&&e.jsx("button",{type:"button",onClick:_,className:"text-sm text-accent hover:text-accent/80 transition duration-300 font-medium",children:"Edit"})]}),m==="shipping"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsx(y,{id:"fullName",label:"Nama Lengkap",children:e.jsx(w,{id:"fullName",defaultValue:u?.name,readOnly:!0,className:"bg-muted/50"})}),e.jsx(y,{id:"email",label:"Email",children:e.jsx(w,{id:"email",defaultValue:u?.email,readOnly:!0,className:"bg-muted/50"})})]}),e.jsx(y,{id:"phone",label:"No. Telepon",tooltip:"Format: 08xxxxxxxxxx atau +62xxxxxxxxxx",children:e.jsx(w,{id:"phone",value:a.phone,onChange:s=>P("phone",s.target.value),placeholder:"08xxxxxxxxxx",required:!0,className:g.errors.some(s=>s.includes("telepon"))?"border-red-500":""})}),e.jsx(y,{id:"street",label:"Alamat Lengkap",children:e.jsx("textarea",{id:"street",value:a.street,onChange:s=>P("street",s.target.value),placeholder:"Jalan, No. Rumah, RT/RW, Kelurahan, Kecamatan",className:`w-full p-3 border rounded-xl bg-card/60 min-h-[80px] resize-none transition duration-300 focus:border-accent focus:ring-2 focus:ring-accent/40 ${g.errors.some(s=>s.includes("Alamat"))?"border-red-500":"border-border"}`,required:!0})}),e.jsx("div",{className:"grid sm:grid-cols-2 gap-4",children:e.jsx(y,{id:"postalCode",label:"Kode Pos",tooltip:"5 digit kode pos Indonesia",children:e.jsx(w,{id:"postalCode",value:a.postalCode,onChange:s=>P("postalCode",s.target.value),placeholder:"12345",maxLength:5,required:!0,className:g.errors.some(s=>s.includes("Kode pos"))?"border-red-500":""})})}),e.jsx(ie,{shippingAddress:a,onShippingCostChange:W,cartWeight:K,onAddressChange:P}),g.errors.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-2",children:"Perhatian:"}),e.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:g.errors.map((s,d)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1 h-1 bg-red-600 rounded-full"}),s]},d))})]}),e.jsx("div",{className:"mt-6",children:e.jsx(R,{type:"button",onClick:J,disabled:!g.isValid,className:"w-full rounded-full font-bold bg-gradient-to-r from-warning to-accent hover:opacity-90 text-white py-3 disabled:opacity-50",children:"Lanjut ke Pembayaran Preorder"})})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-start gap-3 p-4 bg-muted/30 rounded-lg",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:u?.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u?.email}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.phone})]})}),e.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg",children:[e.jsx("p",{className:"text-sm",children:a.street}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.city,", ",a.postalCode]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-accent/10 rounded-lg",children:[e.jsx(E,{size:16,className:"text-accent"}),e.jsxs("span",{className:"text-sm font-medium text-accent",children:[k," - ",x.formatPrice(l)]}),l===0&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full",children:"GRATIS"})]})]})]}),e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center gap-2",children:[e.jsx(z,{size:20,className:"text-warning"}),"Pembayaran Preorder"]}),m==="payment"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-warning/10 border border-warning/20 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(L,{className:"w-5 h-5 text-warning"}),e.jsx("span",{className:"font-semibold text-warning",children:"Preorder Exclusive"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preorder items require Virtual Account payment for secure processing and production planning."})]}),e.jsx(T,{value:O,onChange:q,className:"space-y-3",children:H.map(s=>e.jsx(T.Option,{value:s.id,children:({checked:d})=>e.jsxs("div",{className:`rounded-xl border px-6 py-4 transition duration-300 cursor-pointer relative ${d?"border-warning ring-2 ring-warning/50 bg-warning/5":"border-border hover:border-warning/40 hover:bg-warning/5"}`,children:[s.recommended&&e.jsx("span",{className:"absolute -top-2 left-4 px-2 py-1 text-xs font-medium bg-warning text-white rounded-full",children:"Required for Preorder"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.icon,{size:20,className:"text-foreground/70"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.desc})]})]}),d&&e.jsx(oe,{className:"text-warning",size:20})]})]})},s.id))})]})]})]}),e.jsx("div",{className:"lg:col-span-2 lg:sticky lg:top-24 self-start",children:e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-6 flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-warning"}),"Preorder Summary"]}),e.jsx("div",{className:"space-y-3 mb-6",children:p.map(s=>e.jsx(ce,{item:s},`${s._id}-${s.size}`))}),e.jsx("div",{className:"border-t border-border my-6"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(C,{label:"Subtotal",value:x.formatPrice(v.subtotal)}),v.preorderSavings>0&&e.jsx(C,{label:"Preorder Savings",value:`-${x.formatPrice(v.preorderSavings)}`,className:"text-green-600"}),e.jsx(C,{label:`Ongkir (${k})`,value:l===0?"GRATIS":x.formatPrice(v.shippingFee),className:l===0?"text-green-600":""})]}),e.jsx("div",{className:"border-t border-border my-6"}),e.jsx(C,{label:"Total Preorder",value:x.formatPrice(v.total),highlight:!0}),e.jsx("div",{className:"bg-warning/5 border border-warning/20 rounded-lg p-4 mt-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx($,{className:"w-5 h-5 text-warning mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-warning mb-1",children:"Preorder Timeline"}),e.jsxs("ul",{className:"text-muted-foreground space-y-1",children:[e.jsx("li",{children:"â€¢ Payment: Immediate VA processing"}),e.jsx("li",{children:"â€¢ Production: 2-3 weeks after preorder closes"}),e.jsx("li",{children:"â€¢ Shipping: 1-2 weeks after production"}),e.jsx("li",{children:"â€¢ Delivery: 4-6 weeks total"})]})]})]})}),e.jsxs(R,{type:"submit",size:"lg",disabled:m!=="payment"||V==="loading"||!g.isValid,className:"w-full mt-6 rounded-full font-bold bg-gradient-to-r from-warning to-accent hover:opacity-90 text-white py-4 disabled:opacity-50 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-warning/20 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"}),e.jsx(M,{size:18,className:"mr-2"}),V==="loading"?"Memproses Preorder...":"Bayar Preorder Sekarang"]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center mt-3",children:"Anda akan diarahkan ke halaman pembayaran VA yang aman"}),e.jsxs("div",{className:"flex items-center justify-center space-x-4 mt-4 pt-4 border-t border-border",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground",children:[e.jsx(M,{size:12}),e.jsx("span",{children:"SSL Secure"})]}),e.jsx("div",{className:"w-1 h-1 bg-muted-foreground rounded-full"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Preorder Guaranteed"})]})]})})]})]})]})};export{we as default};
