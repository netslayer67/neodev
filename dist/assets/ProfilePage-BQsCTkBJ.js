const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Review-CImLqce7.js","assets/index-DZQ2CCKA.js","assets/index-CnsjXSBg.css","assets/message-square-CR-EIN-b.js","assets/chevron-down--hJ2Oq-a.js"])))=>i.map(i=>d[i]);
import{u as H,h as G,F as Q,i as X,b as J,r as n,a as R,G as W,H as Y,J as Z,j as e,m as d,B as v,I as ee,P as M,U as A,o as O,c as V,A as T,X as se,_ as te}from"./index-DZQ2CCKA.js";import{C as ae}from"./chevron-left-BjiBrtjZ.js";import{L as D}from"./log-out-CWzxxANf.js";import{S as ne}from"./search-BJN9olYM.js";import{C as re}from"./check-circle-DIgt1TQm.js";const ie=n.lazy(()=>te(()=>import("./Review-CImLqce7.js"),__vite__mapDeps([0,1,2,3,4]))),le=(t="")=>String(t).slice(0,80).replace(/(<([^>]+)>)/gi,"").replace(/https?:\/\/[^"]+/gi,"").trim(),oe=(t,o)=>{const[i,c]=n.useState(t);return n.useEffect(()=>{const r=setTimeout(()=>c(t),o);return()=>clearTimeout(r)},[t,o]),i},B=n.memo(({order:t,onClick:o,reduceMotion:i})=>{const c=n.useMemo(()=>{switch(t.status){case"Delivered":return"bg-success/20 text-success";case"Cancelled":return"bg-error/20 text-error";default:return"bg-warning/20 text-warning"}},[t.status]),r=n.useMemo(()=>new Date(t.createdAt).toLocaleDateString("id-ID"),[t.createdAt]),l=n.useMemo(()=>t.totalAmount.toLocaleString("id-ID"),[t.totalAmount]),g=n.useMemo(()=>{const w=t.items?.[0]?.name||"",k=t.items?.length>1?` +${t.items.length-1} lainnya`:"";return w+k},[t.items]),s=n.useCallback(()=>o(t),[t,o]),f=i?"button":d.button,j=i?{}:{whileHover:{scale:1.01},transition:{duration:.2}};return e.jsxs(f,{...j,onClick:s,className:"w-full text-left p-4 rounded-2xl glass-card flex items-center justify-between gap-4 will-change-transform",children:[e.jsx("div",{className:"flex items-start gap-3 min-w-0 flex-1",children:e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"text-sm font-mono text-muted-foreground truncate",children:["#",t.orderId]}),e.jsx("p",{className:"text-sm text-foreground truncate",children:g}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r})]})}),e.jsxs("div",{className:"flex flex-col items-end flex-shrink-0",children:[e.jsxs("p",{className:"font-bold text-secondary",children:["Rp ",l]}),e.jsx("span",{className:`text-[0.563rem] px-3 py-1 rounded-full mt-2 whitespace-nowrap ${c}`,children:t.status})]})]})});B.displayName="OrderRow";const y=n.memo(({icon:t,label:o,isActive:i,onClick:c,className:r=""})=>e.jsxs("button",{onClick:c,className:`flex-1 py-2 flex flex-col items-center gap-1 transition-colors duration-200 ${i?"text-foreground":"text-muted-foreground"} ${r}`,children:[e.jsx(t,{size:18}),e.jsx("span",{className:"text-xs",children:o})]}));y.displayName="NavButton";const $=n.memo(({user:t})=>e.jsx(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"space-y-4",children:e.jsx("div",{className:"glass-card p-4 rounded-2xl",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-card/80 flex items-center justify-center overflow-hidden flex-shrink-0",children:e.jsx(A,{size:28})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-lg truncate",children:t?.name}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:t?.email}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Bergabung ",new Date(t?.createdAt).toLocaleDateString("id-ID")]})]})]})})}));$.displayName="UserProfile";const fe=()=>{const t=H(),o=G(),i=Q(),{toast:c}=X(),r=J();console.log("ProfilePage location state:",i.state),console.log("ProfilePage activeView from state:",i.state?.activeView);const[l,g]=n.useState(i.state?.activeView||"orders");console.log("ProfilePage initial activeView:",l);const[s,f]=n.useState(null),[j,w]=n.useState(""),[k,I]=n.useState(!1),b=oe(j,300),{user:m,status:ce}=R(a=>a.auth||{}),{myOrders:N=[],status:p}=R(a=>a.orders||{});n.useEffect(()=>{m&&p==="idle"&&t(W())},[m,t,p]),n.useEffect(()=>{i.state?.activeView&&g(i.state.activeView)},[i.state]),n.useEffect(()=>(document.body.style.overflow=s?"hidden":"",()=>{document.body.style.overflow=""}),[s]);const C=n.useCallback(()=>{t(Y()),o("/")},[t,o]),_=n.useCallback(a=>{f(a)},[]),E=n.useCallback(async()=>{if(s){console.log("Cancelling order:",s.orderId,"for user:",m?._id);try{await t(Z(s.orderId)).unwrap(),c({title:"Pesanan Dibatalkan",description:`Pesanan #${s.orderId} berhasil dibatalkan.`}),f(null),I(!0),setTimeout(()=>I(!1),2e3)}catch(a){console.error("Cancel order error:",a),c({variant:"destructive",title:"Gagal Membatalkan Pesanan",description:a.message||"Terjadi kesalahan saat membatalkan pesanan."})}}},[t,s,c,m]),F=n.useCallback(a=>{w(a.target.value)},[]),P=n.useCallback(()=>{f(null)},[]),u=n.useCallback(a=>{g(a)},[]),L=n.useMemo(()=>{if(!Array.isArray(N))return[];const x=[...N].sort((h,S)=>new Date(S.createdAt)-new Date(h.createdAt)).filter(h=>h.status!=="Cancelled");if(!b)return x;const z=le(b).toLowerCase();return x.filter(h=>h.orderId.toLowerCase().includes(z)||h.items?.some(S=>(S.name||"").toLowerCase().includes(z)))},[N,b]),K=n.useMemo(()=>m?.name?.split?.(" ")[0]||"User",[m?.name]),U=n.useMemo(()=>({initial:{opacity:0},animate:{opacity:1},transition:{duration:r?.1:.3}}),[r]),q=n.useMemo(()=>({initial:{opacity:0,y:r?0:40},animate:{opacity:1,y:0},exit:{opacity:0,y:r?0:40},transition:{duration:r?.1:.32}}),[r]);return e.jsxs(d.div,{className:"relative min-h-screen pt-20 pb-24 px-4 text-foreground font-sans",...U,children:[!r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute -top-24 -left-20 w-72 h-72 bg-accent/25 rounded-full blur-3xl will-change-transform"}),e.jsx("div",{className:"absolute -bottom-28 -right-20 w-96 h-96 bg-secondary/30 rounded-full blur-3xl will-change-transform"})]}),e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("header",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h1",{className:"text-2xl font-heading font-bold truncate",children:["Halo, ",K," ðŸ‘‹"]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Kelola akun & pesanan Anda"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>o(-1),className:"rounded-lg border border-border","aria-label":"Kembali",children:e.jsx(ae,{size:18})}),e.jsx(v,{variant:"ghost",size:"icon",onClick:C,className:"rounded-lg border border-border","aria-label":"Keluar",children:e.jsx(D,{size:18})})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-6",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ee,{value:j,onChange:F,placeholder:"Cari pesanan atau produk...",className:"pl-10 bg-card/60 border border-border rounded-xl focus:ring-2 focus:ring-accent/30 transition-all duration-200","aria-label":"Pencarian pesanan"}),e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none",size:18})]})}),e.jsxs("div",{className:"space-y-6",children:[l==="account"&&e.jsx($,{user:m}),l==="orders"&&e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:r?.1:.3},className:"space-y-4",children:[p==="loading"&&e.jsx(M,{}),e.jsxs("div",{className:"flex flex-col gap-3",children:[p==="succeeded"&&L.length===0&&e.jsx("div",{className:"glass-card p-6 text-center text-muted-foreground",children:b?"Tidak ada pesanan yang cocok.":"Belum ada pesanan."}),p==="succeeded"&&L.map(a=>e.jsx(B,{order:a,onClick:_,reduceMotion:r},a.orderId))]})]}),l==="reviews"&&e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:r?.1:.3},children:e.jsx(n.Suspense,{fallback:e.jsx(M,{}),children:e.jsx(ie,{products:N.flatMap(a=>a.items.map(x=>x.productData||x)),onSubmit:a=>console.log("Review:",a)})})})]})]}),e.jsxs("nav",{className:"fixed left-1/2 -translate-x-1/2 bottom-4 z-40 w-[94%] max-w-3xl flex items-center justify-between glass-card px-3 py-2 rounded-3xl shadow-xl md:hidden",children:[e.jsx(y,{icon:A,label:"Info",isActive:l==="account",onClick:()=>u("account")}),e.jsx(y,{icon:O,label:"Pesanan",isActive:l==="orders",onClick:()=>u("orders")}),e.jsx(y,{icon:V,label:"Review",isActive:l==="reviews",onClick:()=>u("reviews")}),e.jsx("button",{onClick:C,className:"py-2 px-3 rounded-xl text-error transition-colors duration-200 hover:bg-error/10","aria-label":"Keluar",children:e.jsx(D,{size:18})})]}),e.jsx(T,{mode:"wait",children:s&&e.jsx(d.div,{className:"fixed inset-0 z-50 bg-overlay backdrop-blur-glass flex justify-center items-center p-4",...q,onClick:P,children:e.jsxs(d.div,{onClick:a=>a.stopPropagation(),className:"w-full max-w-2xl glass-card p-6 rounded-3xl will-change-transform max-h-[90vh] overflow-y-auto scrollbar-hide",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h3",{className:"text-xl font-heading font-bold truncate",children:["Pesanan #",s.orderId]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:new Date(s.createdAt).toLocaleString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx("button",{onClick:P,className:"text-muted-foreground hover:text-foreground transition-colors p-2 flex-shrink-0","aria-label":"Tutup",children:e.jsx(se,{size:24})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"glass-card p-4",children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Status Pesanan"}),e.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium ${s.status==="Telah Sampai"?"bg-success/20 text-success":s.status==="Dikirim"?"bg-info/20 text-info":s.status==="Diproses"?"bg-warning/20 text-warning":s.status==="Pending Payment"?"bg-error/20 text-error":"bg-muted/20 text-muted-foreground"}`,children:s.status})]}),e.jsxs("div",{className:"glass-card p-4",children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground mb-2",children:"Metode Pembayaran"}),e.jsx("span",{className:"text-sm font-medium",children:s.paymentMethod==="va"?"Virtual Account":"Cash On Delivery"}),s.transactionId&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["TXN: ",s.transactionId]})]})]}),e.jsxs("div",{className:"glass-card p-4 mb-6",children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground mb-3",children:"Detail Produk"}),e.jsx("div",{className:"space-y-3 max-h-48 overflow-y-auto scrollbar-hide",children:s.items?.map((a,x)=>e.jsxs("div",{className:"flex justify-between items-start gap-4 py-2 border-b border-border/50 last:border-b-0",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"font-medium text-sm block truncate",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Size ",a.size]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Ã—"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[a.quantity," pcs"]})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsxs("div",{className:"font-mono text-sm",children:["Rp ",(a.price*a.quantity).toLocaleString("id-ID")]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["@ Rp ",a.price.toLocaleString("id-ID")]})]})]},`${a.product}-${x}`))})]}),e.jsxs("div",{className:"glass-card p-4 mb-6",children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground mb-3",children:"Rincian Pembayaran"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal Produk"}),e.jsxs("span",{className:"font-mono",children:["Rp ",s.itemsPrice?.toLocaleString("id-ID")||s.totalAmount.toLocaleString("id-ID")]})]}),s.shippingPrice>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Biaya Pengiriman"}),e.jsxs("span",{className:"font-mono",children:["Rp ",s.shippingPrice.toLocaleString("id-ID")]})]}),s.adminFee>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Biaya Admin COD"}),e.jsxs("span",{className:"font-mono",children:["Rp ",s.adminFee.toLocaleString("id-ID")]})]}),s.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm text-success",children:[e.jsx("span",{children:"Diskon"}),e.jsxs("span",{className:"font-mono",children:["-Rp ",s.discount.toLocaleString("id-ID")]})]}),e.jsx("div",{className:"border-t border-border pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-semibold text-base",children:[e.jsx("span",{children:"Total Pembayaran"}),e.jsxs("span",{className:"font-mono text-accent",children:["Rp ",s.totalAmount.toLocaleString("id-ID")]})]})})]})]}),s.shippingAddress&&e.jsxs("div",{className:"glass-card p-4 mb-6",children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground mb-3",children:"Alamat Pengiriman"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("p",{className:"font-medium",children:s.user?.name}),e.jsx("p",{children:s.shippingAddress.street}),e.jsxs("p",{className:"text-muted-foreground",children:[s.shippingAddress.city,", ",s.shippingAddress.postalCode]}),e.jsx("p",{className:"text-muted-foreground",children:s.shippingAddress.country}),e.jsxs("p",{className:"text-muted-foreground",children:["ðŸ“ž ",s.shippingAddress.phone]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[["Diproses","Pending Payment"].includes(s.status)&&e.jsx(v,{variant:"destructive",className:"flex-1",onClick:E,children:"Batalkan Pesanan"}),e.jsx(v,{variant:"outline",className:"flex-1",onClick:P,children:"Tutup"})]})]})})}),e.jsx(T,{children:k&&e.jsx(d.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.3},children:e.jsx("div",{className:"bg-success/90 p-5 rounded-full shadow-2xl",children:e.jsx(re,{className:"text-foreground",size:36})})})}),e.jsx("div",{className:"hidden md:block fixed top-32 right-6 w-48",children:e.jsxs("aside",{className:"glass-card p-3 rounded-2xl space-y-2",children:[e.jsxs("button",{onClick:()=>u("account"),className:`w-full text-left py-2 px-3 rounded-lg flex items-center gap-3 transition-colors duration-200 ${l==="account"?"bg-accent/20 text-foreground":"text-muted-foreground hover:bg-card/50"}`,children:[e.jsx(A,{size:16})," Info"]}),e.jsxs("button",{onClick:()=>u("orders"),className:`w-full text-left py-2 px-3 rounded-lg flex items-center gap-3 transition-colors duration-200 ${l==="orders"?"bg-accent/20 text-foreground":"text-muted-foreground hover:bg-card/50"}`,children:[e.jsx(O,{size:16})," Pesanan"]}),e.jsxs("button",{onClick:()=>u("reviews"),className:`w-full text-left py-2 px-3 rounded-lg flex items-center gap-3 transition-colors duration-200 ${l==="reviews"?"bg-accent/20 text-foreground":"text-muted-foreground hover:bg-card/50"}`,children:[e.jsx(V,{size:16})," Review"]}),e.jsxs("button",{onClick:C,className:"w-full text-left py-2 px-3 rounded-lg flex items-center gap-3 text-error hover:bg-error/10 transition-colors duration-200",children:[e.jsx(D,{size:16})," Keluar"]})]})})]})};export{fe as default};
